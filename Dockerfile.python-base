FROM python:3.12

WORKDIR /tmp
RUN pip install huggingface_hub
COPY $MAIN/download_model.py* dm.py
RUN bash -c 'if [[ -f dm.py ]]; then python dm.py; fi'

WORKDIR /app

COPY requirements.txt .
RUN pip install -r requirements.txt

ARG MAIN
COPY common common
COPY $MAIN $MAIN

ENV MAIN=$MAIN
ENV PYTHONPATH=/app
ENV PYTHONUNBUFFERED=1
CMD python $MAIN/main.py
